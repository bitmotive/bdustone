{{!-- There are 2 code paths for generating the PDP pricing HTML determined by the following #and condition. 
If a 'price_range' exists then we generate all HTML in price-range.html, otherwise it is defined here. Both code
paths generate the same HTML structure with some differences in whether that element is displayed by default (css styling).

If you are making a change here or in price-range.html, you probably want to make that change in both files. --}}

{{#and price.price_range (if theme_settings.price_ranges '==' true)}}
    {{> components/products/price-range price=price schema_org=schema_org}}
{{else}}
    {{#if price.with_tax}}
        {{#unless price.rrp_with_tax}}
            <p class="price">{{theme_settings.pdp-retail-price-label}} <span data-product-rrp-with-tax>{{price.rrp_with_tax.formatted}}</span></p>
        {{/unless}}
        {{#unless price.non_sale_price_with_tax}}
            <p class="price">{{theme_settings.pdp-non-sale-price-label}} <span data-product-non-sale-price-with-tax>{{price.non_sale_price_with_tax.formatted}}</span></p>
        {{/unless}}
        <p class="price" itemprop="offers" itemscope itemtype="http://schema.org/Offer">
            {{#if price.non_sale_price_with_tax}}
            <span>
                {{theme_settings.pdp-price-label}}
            </span>
            {{/if}}
            {{#unless price.non_sale_price_with_tax}}
            <span>
                {{theme_settings.pdp-sale-price-label}}
            </span>
            {{/unless}}
            <span data-product-price-with-tax>{{price.with_tax.formatted}}</span>
            {{#if schema_org}}
                <meta itemprop="availability" itemtype="http://schema.org/ItemAvailability" 
                    content="http://schema.org/{{#if product.pre_order}}PreOrder{{else if product.out_of_stock}}OutOfStock{{else if product.can_purchase '===' false}}OutOfStock{{else}}InStock{{/if}}">
                <meta itemprop="itemCondition" itemtype="http://schema.org/OfferItemCondition" content="http://schema.org/{{product.condition}}Condition">
                <meta itemprop="priceCurrency" content="{{currency_selector.active_currency_code}}">
                <meta itemprop="url" content="{{product.url}}">
                <div itemprop="priceSpecification" itemscope itemtype="http://schema.org/PriceSpecification">
                    <meta itemprop="price" content="{{price.with_tax.value}}">
                    <meta itemprop="priceCurrency" content="{{currency_selector.active_currency_code}}">
                    <meta itemprop="valueAddedTaxIncluded" content="true">
                </div>
            {{/if}}
            {{#if price.without_tax}}
                <span class="info">{{lang 'products.price_with_tax' tax_label=price.tax_label}}</span>
            {{/if}}
        </p>
    {{/if}}
    {{#if price.with_tax}}
        <p class="price" itemprop="offers" itemscope itemtype="http://schema.org/Offer">
            {{#if price.non_sale_price_with_tax}}
            <span>
                {{theme_settings.pdp-price-label}}
            </span>
            {{/if}}
            {{#unless price.non_sale_price_with_tax}}
            <span>
                {{theme_settings.pdp-sale-price-label}}
            </span>
            {{/unless}}
            <span data-product-price-with-tax>{{price.with_tax.formatted}}</span>
            {{#if schema_org}}
                <meta itemprop="availability" itemtype="http://schema.org/ItemAvailability" 
                	content="http://schema.org/{{#if product.pre_order}}PreOrder{{else if product.out_of_stock}}OutOfStock{{else if product.can_purchase '===' false}}OutOfStock{{else}}InStock{{/if}}">
                <meta itemprop="itemCondition" itemtype="http://schema.org/OfferItemCondition" content="http://schema.org/{{product.condition}}Condition">
                <meta itemprop="priceCurrency" content="{{currency_selector.active_currency_code}}">
                <meta itemprop="url" content="{{product.url}}">
                <div itemprop="priceSpecification" itemscope itemtype="http://schema.org/PriceSpecification">
                    <meta itemprop="price" content="{{price.with_tax.value}}">
                    <meta itemprop="priceCurrency" content="{{currency_selector.active_currency_code}}">
                    <meta itemprop="valueAddedTaxIncluded" content="true">
                </div>
            {{/if}}
            {{#if price.without_tax}}
                <span class="info">{{lang 'products.price_with_tax' tax_label=price.tax_label}}</span>
            {{/if}}
        </p>
    {{/if}}
    {{#if price.without_tax}}
        {{#if price.rrp_without_tax}}
        <p class="price">
            {{theme_settings.pdp-retail-price-label}}
            <span data-product-rrp-price-without-tax class="price price--rrp"> 
                {{price.rrp_without_tax.formatted}}
            </span>
        </p>
        {{/if}}
        {{#if price.non_sale_price_without_tax}}
        <p class="price">
            {{theme_settings.pdp-non-sale-price-label}}
            <span data-product-non-sale-price-without-tax>
                {{price.non_sale_price_without_tax.formatted}}
            </span>
        </p>
        {{/if}}
        <p class="price" itemprop="offers" itemscope itemtype="http://schema.org/Offer">
            {{#if price.non_sale_price_without_tax}}
            <span class="price-label">
                {{theme_settings.pdp-price-label}}
            </span>
            {{/if}}
            {{#if price.non_sale_price_without_tax}}
            {{!--<span class="price-now-label">
                {{theme_settings.pdp-sale-price-label}}
            </span>--}}
            {{/if}}
            <span data-product-price-without-tax>{{price.without_tax.formatted}}</span>
            {{#if schema_org}}
                <meta itemprop="availability" itemtype="http://schema.org/ItemAvailability"
                    content="http://schema.org/{{#if product.pre_order}}PreOrder{{else if product.out_of_stock}}OutOfStock{{else if product.can_purchase '===' false}}OutOfStock{{else}}InStock{{/if}}">
                <meta itemprop="itemCondition" itemtype="http://schema.org/OfferItemCondition" content="http://schema.org/{{product.condition}}Condition">
                <meta itemprop="priceCurrency" content="{{currency_selector.active_currency_code}}">
                <meta itemprop="url" content="{{product.url}}">
                <div itemprop="priceSpecification" itemscope itemtype="http://schema.org/PriceSpecification">
                    <meta itemprop="price" content="{{price.without_tax.value}}">
                    <meta itemprop="priceCurrency" content="{{currency_selector.active_currency_code}}">
                    <meta itemprop="valueAddedTaxIncluded" content="false">
                </div>
            {{/if}}
            {{#if price.with_tax}}
                <span class="info">{{lang 'products.price_without_tax' tax_label=price.tax_label}}</abbr>
            {{/if}}
        </p>
    {{/if}}
    {{#if page_type '===' 'product'}}
        {{#if price.saved}}
            <p class="price-saved">
                {{lang 'products.you_save_opening_text'}}
                <span class="savings">
                    {{price.saved.formatted}}
                </span>
                <span>{{lang 'products.you_save_closing_bracket'}}</span>
            </p>
        {{/if}}
    {{/if}}
{{/and}}
